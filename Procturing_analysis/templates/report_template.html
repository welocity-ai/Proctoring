<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>AI Proctoring Report</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #0b3d91; }
    .section { margin-bottom: 30px; }
    .face-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .face-item { width: 250px; border: 1px solid #ddd; padding: 8px; border-radius: 8px; }
    .face-item img { width: 100%; height: auto; }
    audio { width: 100%; margin-top: 8px; }
  </style>
</head>
<body>
  <h1>AI Proctoring Report</h1>
  <p><strong>Video:</strong> {{ video_filename }}</p>
  <p><strong>Duration:</strong> {{ duration_hhmmss }}</p>

  <div class="section">
    <h2>Face Detections ({{ face_count }})</h2>
    {% if face_count == 0 %}
      <p>No faces detected.</p>
    {% else %}
      <div class="face-grid">
        {% for f in faces %}
        <div class="face-item">
          <p><strong>Time:</strong> {{ f.hhmmss }} ({{ "%.2f"|format(f.timestamp) }}s)</p>
          <img src="data:image/jpeg;base64,{{ f.image_b64 }}" alt="face">
          <p><small>bbox: {{ f.bbox }}</small></p>
        </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <div class="section">
    <h2>Voice Diarization</h2>
    <p><strong>Primary speaker:</strong> {{ primary_speaker }}</p>

    <h3>Flagged Voice Snippets (non-primary)</h3>
    {% if flags %}
      <ul>
      {% for fl in flags %}
        <li>
          {{ fl.hhmmss_start }} → {{ fl.hhmmss_end }} ({{ "%.2f"|format(fl.end - fl.start) }}s) — {{ fl.speaker }}<br/>
          <audio controls src="{{ fl.snippet_fname }}"></audio>
        </li>
      {% endfor %}
      </ul>
    {% else %}
      <p>No non-primary speakers flagged.</p>
    {% endif %}
  </div>

</body>
</html>
